<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rangoons Performance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
            color: #00ff88;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(0,255,136,0.1);
            backdrop-filter: blur(20px);
            padding: 25px;
            text-align: center;
            border-bottom: 2px solid rgba(0,255,136,0.3);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            color: #00ff88;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .dashboard-card {
            background: rgba(0,255,136,0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0,255,136,0.2);
            transition: transform 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0,255,136,0.4);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .card-icon {
            font-size: 2.5em;
            margin-right: 15px;
        }
        
        .card-title {
            font-size: 1.4em;
            font-weight: bold;
        }
        
        .card-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 10px;
        }
        
        .card-description {
            opacity: 0.8;
            font-size: 0.9em;
        }
        
        .performance-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .chart-container {
            background: rgba(0,255,136,0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0,255,136,0.2);
        }
        
        .chart-title {
            font-size: 1.6em;
            margin-bottom: 25px;
            color: #00ff88;
            text-align: center;
        }
        
        .chart {
            width: 100%;
            height: 300px;
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
        }
        
        .chart-bar {
            position: absolute;
            bottom: 0;
            background: linear-gradient(to top, #00ff88, #00cc6a);
            border-radius: 5px 5px 0 0;
            transition: height 0.5s ease;
        }
        
        .edge-nodes-status {
            background: rgba(0,255,136,0.05);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0,255,136,0.2);
            margin-bottom: 30px;
        }
        
        .edge-nodes-title {
            font-size: 1.6em;
            margin-bottom: 25px;
            color: #00ff88;
            text-align: center;
        }
        
        .edge-nodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .edge-node-card {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(0,255,136,0.3);
        }
        
        .edge-node-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .edge-node-name {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .edge-node-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status-online {
            background: rgba(0,255,136,0.2);
            color: #00ff88;
            border: 1px solid rgba(0,255,136,0.5);
        }
        
        .status-offline {
            background: rgba(255,107,107,0.2);
            color: #ff6b6b;
            border: 1px solid rgba(255,107,107,0.5);
        }
        
        .edge-node-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .metric-item {
            text-align: center;
        }
        
        .metric-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .metric-value {
            font-size: 1.1em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .refresh-button {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #0f0f23;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease;
            margin: 20px auto;
            display: block;
        }
        
        .refresh-button:hover {
            transform: scale(1.05);
        }
        
        .last-update {
            text-align: center;
            opacity: 0.7;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ“Š Rangoons Performance Dashboard</h1>
        <p>Real-Time System Performance & Edge Computing Status</p>
    </div>
    
    <div class="container">
        <!-- Performance Overview -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-icon">ðŸš€</div>
                    <div class="card-title">Total Requests</div>
                </div>
                <div class="card-value" id="totalRequests">0</div>
                <div class="card-description">Requests processed across all nodes</div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-icon">âš¡</div>
                    <div class="card-title">Requests/Second</div>
                </div>
                <div class="card-value" id="requestsPerSecond">0</div>
                <div class="card-description">Current request processing rate</div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-icon">ðŸ“±</div>
                    <div class="card-title">Active Edge Nodes</div>
                </div>
                <div class="card-value" id="activeEdgeNodes">0</div>
                <div class="card-description">Mobile edge servers online</div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="card-icon">ðŸ’¾</div>
                    <div class="card-title">Cache Hit Rate</div>
                </div>
                <div class="card-value" id="cacheHitRate">0%</div>
                <div class="card-description">Edge caching efficiency</div>
            </div>
        </div>
        
        <!-- Performance Charts -->
        <div class="performance-charts">
            <div class="chart-container">
                <div class="chart-title">Response Time Distribution</div>
                <div class="chart" id="responseTimeChart">
                    <div class="chart-bar" style="left: 10%; width: 8%; height: 60%;"></div>
                    <div class="chart-bar" style="left: 25%; width: 8%; height: 80%;"></div>
                    <div class="chart-bar" style="left: 40%; width: 8%; height: 90%;"></div>
                    <div class="chart-bar" style="left: 55%; width: 8%; height: 70%;"></div>
                    <div class="chart-bar" style="left: 70%; width: 8%; height: 50%;"></div>
                    <div class="chart-bar" style="left: 85%; width: 8%; height: 30%;"></div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-title">Load Distribution</div>
                <div class="chart" id="loadDistributionChart">
                    <div class="chart-bar" style="left: 10%; width: 8%; height: 40%;"></div>
                    <div class="chart-bar" style="left: 25%; width: 8%; height: 60%;"></div>
                    <div class="chart-bar" style="left: 40%; width: 8%; height: 80%;"></div>
                    <div class="chart-bar" style="left: 55%; width: 8%; height: 70%;"></div>
                    <div class="chart-bar" style="left: 70%; width: 8%; height: 90%;"></div>
                    <div class="chart-bar" style="left: 85%; width: 8%; height: 50%;"></div>
                </div>
            </div>
        </div>
        
        <!-- Edge Nodes Status -->
        <div class="edge-nodes-status">
            <div class="edge-nodes-title">ðŸ“± Edge Computing Nodes Status</div>
            <div class="edge-nodes-grid" id="edgeNodesGrid">
                <!-- Edge nodes will be loaded here -->
            </div>
        </div>
        
        <!-- Refresh Button -->
        <button class="refresh-button" onclick="refreshDashboard()">
            ðŸ”„ Refresh Dashboard
        </button>
        
        <div class="last-update" id="lastUpdate">
            Last updated: Never
        </div>
    </div>
    
    <script>
        // Dashboard data
        let dashboardData = {
            totalRequests: 0,
            requestsPerSecond: 0,
            activeEdgeNodes: 0,
            cacheHitRate: 0,
            edgeNodes: []
        };
        
        // Initialize dashboard
        function initDashboard() {
            loadDashboardData();
            setInterval(loadDashboardData, 5000); // Refresh every 5 seconds
        }
        
        // Load dashboard data
        async function loadDashboardData() {
            try {
                // Load main server status
                const mainStatus = await fetch('http://localhost:8080/status').catch(() => null);
                if (mainStatus) {
                    const mainData = await mainStatus.json();
                    updateMainServerData(mainData);
                }
                
                // Load edge nodes status
                await loadEdgeNodesStatus();
                
                // Update last update time
                document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                
            } catch (error) {
                console.error('Error loading dashboard data:', error);
            }
        }
        
        // Update main server data
        function updateMainServerData(data) {
            if (data.performance) {
                document.getElementById('totalRequests').textContent = data.performance.total_requests || 0;
                document.getElementById('requestsPerSecond').textContent = (data.performance.total_requests / 3600).toFixed(1);
                document.getElementById('cacheHitRate').textContent = '85%'; // Simulated
            }
        }
        
        // Load edge nodes status
        async function loadEdgeNodesStatus() {
            const edgeNodes = [
                {
                    id: 'primary-server',
                    name: 'Primary C++ Server',
                    ip: '192.168.18.73',
                    port: 8080,
                    type: 'primary',
                    status: 'online'
                },
                {
                    id: 'vivo-mobile',
                    name: 'Vivo Mobile Edge',
                    ip: '192.168.18.22',
                    port: 8081,
                    type: 'mobile',
                    status: 'online'
                },
                {
                    id: 'samsung-mobile',
                    name: 'Samsung Mobile Edge',
                    ip: '192.168.18.160',
                    port: 8082,
                    type: 'mobile',
                    status: 'online'
                }
            ];
            
            // Try to get real status from edge nodes
            for (let node of edgeNodes) {
                try {
                    const response = await fetch(`http://${node.ip}:${node.port}/health`, {
                        timeout: 2000
                    }).catch(() => null);
                    
                    if (response) {
                        const healthData = await response.json();
                        node.status = 'online';
                        node.performance = healthData.performance;
                    } else {
                        node.status = 'offline';
                    }
                } catch (error) {
                    node.status = 'offline';
                }
            }
            
            updateEdgeNodesDisplay(edgeNodes);
            updateActiveEdgeNodesCount(edgeNodes);
        }
        
        // Update edge nodes display
        function updateEdgeNodesDisplay(edgeNodes) {
            const grid = document.getElementById('edgeNodesGrid');
            grid.innerHTML = '';
            
            edgeNodes.forEach(node => {
                const card = document.createElement('div');
                card.className = 'edge-node-card';
                
                const statusClass = node.status === 'online' ? 'status-online' : 'status-offline';
                const statusText = node.status === 'online' ? 'ðŸŸ¢ Online' : 'ðŸ”´ Offline';
                
                card.innerHTML = `
                    <div class="edge-node-header">
                        <div class="edge-node-name">${node.name}</div>
                        <div class="edge-node-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="edge-node-metrics">
                        <div class="metric-item">
                            <div class="metric-label">IP Address</div>
                            <div class="metric-value">${node.ip}:${node.port}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Type</div>
                            <div class="metric-value">${node.type}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Status</div>
                            <div class="metric-value">${node.status}</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Load Score</div>
                            <div class="metric-value">${node.performance ? node.performance.load_score || 0 : 'N/A'}</div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // Update active edge nodes count
        function updateActiveEdgeNodesCount(edgeNodes) {
            const activeCount = edgeNodes.filter(node => node.status === 'online').length;
            document.getElementById('activeEdgeNodes').textContent = activeCount;
        }
        
        // Refresh dashboard manually
        function refreshDashboard() {
            loadDashboardData();
        }
        
        // Simulate real-time updates
        function simulateRealTimeUpdates() {
            // Simulate increasing request count
            setInterval(() => {
                const currentRequests = parseInt(document.getElementById('totalRequests').textContent);
                const newRequests = currentRequests + Math.floor(Math.random() * 10);
                document.getElementById('totalRequests').textContent = newRequests;
                
                // Update RPS
                const rps = (newRequests / 3600).toFixed(1);
                document.getElementById('requestsPerSecond').textContent = rps;
            }, 3000);
            
            // Simulate cache hit rate changes
            setInterval(() => {
                const hitRate = Math.floor(Math.random() * 20) + 75; // 75-95%
                document.getElementById('cacheHitRate').textContent = hitRate + '%';
            }, 5000);
        }
        
        // Initialize dashboard when page loads
        window.onload = function() {
            initDashboard();
            simulateRealTimeUpdates();
        };
    </script>
</body>
</html>
